{% extends 'mainapp/base.html' %}
{% load static %}

{% block title %}
    <title>–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏–µ–º</title>
{% endblock %}

{%  block extrastyles %} 
<link rel="stylesheet" href="{% static 'mainapp/css/desktop/appointment.css' %}"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}


{% block content %}
{% if user.is_authenticated and not user.is_superuser %}
<form method="post" action="{% url 'appointment_step2' %}">
    <div class="form-header">
        <h1 class="form-title">–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏–µ–º</h1>

        <div class="steps">
            <div class="step active"></div>
            <div class="step active"></div>
            <div class="step"></div>
            <div class="step"></div>
        </div>
    </div>

    <div method="post">
        {% csrf_token %}
        {{ form }}

        <div class="container">
            <div class="row d-flex justify-content-end">
                <div class="col-2">
                    <a href="{% url 'index' %}" style='text-decoration: none;' class="btn btn-left btn-main">–ù–∞–∑–∞–¥</a>

                </div>
                <div class="col-2 ">
                    <button type="submit" class="btn btn-right btn-main text-white">–î–∞–ª–µ–µ</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–∞–º flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/l10n/ru.js"></script>

<script type="module">


    // –ü–µ—Ä–µ–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–∞—Ç –∫–∞–∫ –º–∞—Å—Å–∏–≤ –≤ JavaScript
    const availableDates = JSON.parse("{{ available_dates|safe }}".replace(/'/g, '"'));
    const minDate = "{{ available_dates|first }}";
    const maxDate = "{{ available_dates|last }}"
    
    flatpickr("#datepicker", {
        enable: availableDates, // –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã
        minDate: minDate, 
        maxDate: maxDate,
        dateFormat: "Y-m-d", // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –¥–ª—è flatpickr
        locale: {
            ...flatpickr.l10ns.ru,
            firstDayOfWeek: 1,
        },
        onDayCreate: function(dObj, dStr, fp, dayElem) {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
        const date = dayElem.dateObj.toISOString().split('T')[0];

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤ availableDates, –∏ –æ–Ω–∞ –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ
        if (availableDates.some(d => d.trim() === date)) {
            dayElem.style.textDecoration = "underline"; // –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
        }
        }
    });
</script>
<script>
    document.getElementById("datepicker").placeholder = "–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É              üìÖ";
</script>
{% else %}
    <p class="centered-text">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º &#128521;</p>
{% endif %}



{% endblock %}

