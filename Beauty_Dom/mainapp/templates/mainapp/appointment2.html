{% extends 'mainapp/appointment_base.html' %}
{% load static %}


{%  block extrastyles %} 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block steps %}
<div class="step active"></div>
<div class="step active"></div>
<div class="step"></div>
<div class="step"></div>
{% endblock %}



{% block form %}
{% csrf_token %}
{{ form }}


<!-- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ ÑÐ°Ð¼ flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð»Ð¾ÐºÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ Ñ€ÑƒÑÑÐºÐ¾Ð³Ð¾ ÑÐ·Ñ‹ÐºÐ° -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/l10n/ru.js"></script>

<script type="module">
    
    
    // ÐŸÐµÑ€ÐµÐ´Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð´Ð°Ñ‚ ÐºÐ°Ðº Ð¼Ð°ÑÑÐ¸Ð² Ð² JavaScript
    const availableDates = JSON.parse("{{ available_dates|safe }}".replace(/'/g, '"'));
    const minDate = "{{ available_dates|first }}";
    const maxDate = "{{ available_dates|last }}"
    
    flatpickr("#datepicker", {
        enable: availableDates, // Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð´Ð°Ñ‚Ñ‹
        minDate: minDate, 
        maxDate: maxDate,
        dateFormat: "Y-m-d", // Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ñ‚Ñ‹ Ð´Ð»Ñ flatpickr
        locale: {
            ...flatpickr.l10ns.ru,
            firstDayOfWeek: 1,
        },
        onDayCreate: function(dObj, dStr, fp, dayElem) {
            // ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð´Ð°Ñ‚Ñƒ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ YYYY-MM-DD
            const date = dayElem.dateObj.toISOString().split('T')[0];
            
            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð´Ð°Ñ‚Ð° Ð² availableDates, Ð¸ Ð¾Ð½Ð° Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ
            if (availableDates.some(d => d.trim() === date)) {
                dayElem.style.textDecoration = "underline"; // ÐŸÐ¾Ð´Ñ‡ÐµÑ€ÐºÐ¸Ð²Ð°Ð½Ð¸Ðµ
            }
        }
    });
</script>
<script>
    document.getElementById("datepicker").placeholder = "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ð°Ñ‚Ñƒ              ðŸ“…";
</script>
{% endblock %}


